checkomatic:
  client:
    host: https://platform-api.opentargets.io
    port: 443
    size: 500 # max size to fetch when query and it is applicable
  rules:
    targets:
      ENSG00000198947:
        - o.approved_symbol == 'DMD'
        - o.approved_name == 'dystrophin'
        - o.tractability.smallmolecule.top_category == 'Unknown'
        - o.tractability.antibody.top_category == 'Predicted Tractable - High confidence'
    diseases:
      Orphanet_908:
        - o.label == 'Fragile X syndrome'
        - ('eye disease' in o.therapeutic_labels)
      Orphanet_273:
        - o.label == 'Steinert myotonic dystrophy'
      Orphanet_93256:
        - o.label == 'Fragile X-associated tremor/ataxia syndrome'
    associations:
      targets:
        PRDX1:
        DMD:
          - ('Orphanet_98896' in to_vlist(jp.parse('data[*].disease.id').find(d)))
        CD86:
          - ('EFO_0003885' in to_vlist(jp.parse('data[*].disease.id').find(d)))
        ITGAL:
          - ('EFO_0003767' in to_vlist(jp.parse('data[*].disease.id').find(d)))
      diseases:
        Orphanet_93256:
        EFO_0003767:
          # NOD2, IL10RA, IL23R, ITGAL in IBD
          - not set(['NOD2', 'IL10RA', 'ITGAL']) - to_vset(jp.parse('data[*].target.gene_info.symbol').find(d))
        EFO_0000384:
          # TNF, PTGS2, PTGS1 in crohns disease
          - not set(['TNF', 'PTGS2', 'PTGS1']) - to_vset(jp.parse('data[*].target.gene_info.symbol').find(d))
        EFO_0000249:
          # APP, SORL1, ABCA7, ADAM10 in alzheimers disease
          - not set(['APP', 'SORL1', 'ABCA7', 'ADAM10']) - to_vset(jp.parse('data[*].target.gene_info.symbol').find(d))
        Orphanet_399:
          # huntington disease
          - not set(['HTT']) - to_vset(jp.parse('data[*].target.gene_info.symbol').find(d))
    evidences:
      ENSG00000102081-Orphanet_908:
        - |-
          # http://purl.obolibrary.org/obo/SO_0001583
          so_label = 'missense_variant'
          parser = jp.parse('data[*].evidence.evidence_codes_info[*][*].label')
          output = so_label in to_vlist(parser.find(d))
      ENSG00000143119-EFO_0003767:
        # Check that there is SysBio evidence supporting CD53-IBD association
        - |-
          parser = jp.parse('data[*].sourceID')
          output = 'sysbio' in to_vlist(parser.find(d))
        # Check that there are 2 SysBio gene-sets supporting the CD53-IBD association
        - |-
          parser = jp.parse('data[*].sourceID')
          output = to_vlist(parser.find(d)).count('sysbio') == 2
      ENSG00000160219-EFO_0003767:
        # Check that there is SysBio evidence supporting GAB3-IBD association
        - |-
          parser = jp.parse('data[*].sourceID')
          output = 'sysbio' in to_vlist(parser.find(d))
        # Check that there is a single SysBio gene-set supporting the GAB3-IBD association
        - |-
          parser = jp.parse('data[*].sourceID')
          output = to_vlist(parser.find(d)).count('sysbio') == 1
    searches:
      diseases:
        "crohn disease":
          - len(o.data) > 0
        Orphanet_908:
          - o.data[0].data.name == 'Fragile X syndrome'
          - o.data[0].data.association_counts.total > 400
          - o.data[0].data.association_counts.direct > 400
      targets:
        "mt-nd":
          - len(o.data) > 0
    stats:
      #      - o.data_version == "19.02"
      - o.targets.total > 28000 and o.targets.total < 50000
      - o.diseases.total > 10000 and o.diseases.total < 20000
      - len(o.associations.datatypes.keys()) == 7
      - ('sysbio' in o.associations.datatypes.affected_pathway.datasources)
      - |-
        dts = o.associations.datatypes.keys()
        dss = []
        for dt in dts:
          dss += o.associations.datatypes[dt].datasources.keys()
        output = len(dss) == 19
    metrics:
      - o.data_version == "19.02"
      - o.genes.approved_symbol.doc_count > 58000
